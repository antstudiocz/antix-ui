---
description: Pokyny pro Git workflow a konvence commitÅ¯
globs: 
alwaysApply: false
---
# Antix UI - Git Workflow ğŸŒ³

## VÄ›tvenÃ­ a sprÃ¡va repozitÃ¡Å™e

### HlavnÃ­ vÄ›tve
- **main** - ProdukÄnÃ­ kÃ³d
  - VÅ¾dy stabilnÃ­, pÅ™ipravenÃ½ k nasazenÃ­
  - ChrÃ¡nÄ›nÃ¡ vÄ›tev, vyÅ¾aduje code review
  - OznaÄenÃ¡ verzemi (tagy)

- **development** - VÃ½vojovÃ¡ vÄ›tev
  - IntegraÄnÃ­ vÄ›tev pro feature vÄ›tve
  - Po stabilizaci se merguje do main

### Feature vÄ›tve
- VÅ¾dy vytvÃ¡Å™et z development vÄ›tve
- PojmenovÃ¡nÃ­: `feature/*`, `fix/*`, `docs/*`, `refactor/*`, `test/*`
- Po dokonÄenÃ­ mergovat zpÄ›t do development

## Commit konvence

### FormÃ¡t commit zprÃ¡vy
```
<typ>(<oblast>): <emotikona> <struÄnÃ½ popis>
```

### Typy zmÄ›n
- `feat`: NovÃ¡ funkcionalita
- `fix`: Oprava chyby
- `docs`: ZmÄ›ny v dokumentaci
- `style`: ZmÄ›ny stylÅ¯ a formÃ¡tovÃ¡nÃ­
- `refactor`: Refaktorizace existujÃ­cÃ­ho kÃ³du
- `test`: PÅ™idÃ¡nÃ­ nebo Ãºprava testÅ¯
- `chore`: Ãškoly ÃºdrÅ¾by (build systÃ©m, dependence)

### Emotikony
- âœ¨ NovÃ¡ funkcionalita
- ğŸ› Oprava chyby
- ğŸ“š Dokumentace
- ğŸ¨ StylovÃ¡nÃ­/UI
- ğŸ”„ Refaktorizace
- âœ… Testy
- ğŸ”§ Konfigurace

## DÅ®LEÅ½ITÃ‰: RELEASE PROCES

### PÅ™Ã­prava zmÄ›n v development
1. **Squash commitÅ¯ pÅ™ed mergem do main**
```bash
# Zjistit vÅ¡echny commity od poslednÃ­ synchronizace s main
git log --oneline main..development

# NEBO zjistit poslednÃ­ X commitÅ¯ (pokud je jich hodnÄ›)
git log --oneline -n 20  # ZobrazÃ­ poslednÃ­ch 20 commitÅ¯

# VytvoÅ™it soubor s detailnÃ­m commit message
echo "typ(oblast): ğŸ¨ HlavnÃ­ nadpis zmÄ›n

âœ¨ PrvnÃ­ popis zmÄ›ny
ğŸ› DruhÃ½ popis zmÄ›ny
ğŸ“š TÅ™etÃ­ popis zmÄ›ny" > commit-message.txt

# Squash poslednÃ­ch X commitÅ¯
git reset --soft HEAD~X  # X nahraÄte poÄtem commitÅ¯

# Commit s detailnÃ­m popisem
git commit -F commit-message.txt

# Smazat doÄasnÃ½ soubor
rm commit-message.txt

# Push na origin se -f (force) - POUZE pro development!
git push -f origin development
```

### Merge a release
```bash
# 1. PÅ™epnout na main a aktualizovat
git checkout main
git pull origin main

# 2. Merge development do main (uÅ¾ squashnutÃ½)
git merge development

# 3. DÅ®LEÅ½ITÃ‰: NynÃ­ provÃ©st release
#    - NIKDY nepushovat zmÄ›ny do main bez release!
#    - Release skript automaticky pushne zmÄ›ny!
npm run release:patch  # nebo :minor, :major

# 4. Synchronizovat development s main
git checkout development
git fetch origin
git reset --hard origin/main
git push -f origin development
```

## Pravidla pro kvalitnÃ­ commit message

### KrÃ¡tkÃ½ commit
```
feat(Button): âœ¨ PÅ™idÃ¡na novÃ¡ varianta tlaÄÃ­tka
```

### DetailnÃ­ commit (vÅ¾dy pouÅ¾Ã­vat pro merge do main)
```
feat(Button): âœ¨ PÅ™idÃ¡na novÃ¡ varianta tlaÄÃ­tka

âœ¨ Implementace outline varianty tlaÄÃ­tka
ğŸ¨ VylepÅ¡eno stylovÃ¡nÃ­ pro rÅ¯znÃ© velikosti
ğŸ“š Aktualizace dokumentace a pÅ™Ã­kladÅ¯
âœ… PÅ™idÃ¡ny testy pro novou variantu
```

## Checklist pÅ™ed releasem

- [ ] Proveden squash commitÅ¯ s detailnÃ­m popisem
- [ ] VÅ¡echny testy prochÃ¡zejÃ­ (`npm test`)
- [ ] Build projektu je funkÄnÃ­ (`npm run build`)
- [ ] Verze je vhodnÄ› zvolena podle typu zmÄ›n

## Checklist po releasu

- [ ] Tag byl ÃºspÄ›Å¡nÄ› vytvoÅ™en
- [ ] GitHub release byl vytvoÅ™en
- [ ] Development vÄ›tev je synchronizovÃ¡na s main
- [ ] NPM balÃ­Äek byl publikovÃ¡n

## Å˜eÅ¡enÃ­ bÄ›Å¾nÃ½ch problÃ©mÅ¯

### Aktualizace snapshotÅ¯
```bash
npm test -- -u
git add '**/*.snap'
git commit --amend --no-edit  # PÅ™idÃ¡ snapshoty do poslednÃ­ho commitu
```

### Synchronizace development s main
```bash
git checkout development
git fetch origin
git reset --hard origin/main
git push -f origin development
```

## VylepÅ¡enÃ­ release procesu

### VytvoÅ™enÃ­ bohatÅ¡Ã­ho changelogu
Pro vytvoÅ™enÃ­ lepÅ¡Ã­ho changelogu s popisem vÅ¡ech zmÄ›n mÅ¯Å¾eme pouÅ¾Ã­t vlastnÃ­ skript:

1. **VytvoÅ™enÃ­ skriptu pro generovÃ¡nÃ­ changelogu**
   VytvoÅ™te soubor `scripts/generate-changelog.js`:
   ```javascript
   const { execSync } = require('child_process');
   const fs = require('fs');
   
   // ZÃ­skÃ¡ poslednÃ­ verzi/tag
   const getLatestTag = () => {
     return execSync('git describe --tags --abbrev=0').toString().trim();
   };
   
   // ZÃ­skÃ¡ pÅ™edchozÃ­ verzi/tag
   const getPreviousTag = (latestTag) => {
     const tags = execSync('git tag -l --sort=-v:refname').toString().trim().split('\n');
     const index = tags.indexOf(latestTag);
     return index < tags.length - 1 ? tags[index + 1] : null;
   };
   
   // Generuje popis zmÄ›n mezi tagy
   const generateChangelog = (fromTag, toTag) => {
     // ZÃ­skÃ¡ vÅ¡echny commity s detailnÃ­m popisem
     const commits = execSync(`git log ${fromTag}..${toTag} --pretty=format:"%s%n%b%n==COMMIT=="`)
       .toString().split('==COMMIT==')
       .filter(Boolean)
       .map(commit => commit.trim());
     
     // Kategorizace zmÄ›n
     const features = [];
     const fixes = [];
     const docs = [];
     const other = [];
     
     for (const commit of commits) {
       const lines = commit.split('\n').filter(Boolean);
       const title = lines[0];
       const body = lines.slice(1);
       
       if (title.includes('feat') || title.includes('âœ¨')) {
         features.push({ title, body });
       } else if (title.includes('fix') || title.includes('ğŸ›')) {
         fixes.push({ title, body });
       } else if (title.includes('docs') || title.includes('ğŸ“š')) {
         docs.push({ title, body });
       } else {
         other.push({ title, body });
       }
     }
     
     // SestavenÃ­ changelogu
     let changelog = '## Co je novÃ©ho\n\n';
     
     if (features.length) {
       changelog += '### âœ¨ NovÃ© funkce\n\n';
       for (const { title, body } of features) {
         changelog += `- ${title}\n`;
         if (body.length) {
           body.forEach(line => {
             if (line.trim()) changelog += `  - ${line.trim()}\n`;
           });
         }
       }
       changelog += '\n';
     }
     
     if (fixes.length) {
       changelog += '### ğŸ› Opravy\n\n';
       for (const { title, body } of fixes) {
         changelog += `- ${title}\n`;
         if (body.length) {
           body.forEach(line => {
             if (line.trim()) changelog += `  - ${line.trim()}\n`;
           });
         }
       }
       changelog += '\n';
     }
     
     if (docs.length) {
       changelog += '### ğŸ“š Dokumentace\n\n';
       for (const { title, body } of docs) {
         changelog += `- ${title}\n`;
         if (body.length) {
           body.forEach(line => {
             if (line.trim()) changelog += `  - ${line.trim()}\n`;
           });
         }
       }
       changelog += '\n';
     }
     
     if (other.length) {
       changelog += '### ğŸ”„ OstatnÃ­ zmÄ›ny\n\n';
       for (const { title, body } of other) {
         changelog += `- ${title}\n`;
         if (body.length) {
           body.forEach(line => {
             if (line.trim()) changelog += `  - ${line.trim()}\n`;
           });
         }
       }
     }
     
     return changelog;
   };
   
   // HlavnÃ­ logika
   const latestTag = getLatestTag();
   const previousTag = getPreviousTag(latestTag);
   
   if (previousTag) {
     const changelog = generateChangelog(previousTag, latestTag);
     fs.writeFileSync('CHANGELOG.md', changelog);
     console.log(`Changelog vygenerovÃ¡n pro verze ${previousTag} -> ${latestTag}`);
   } else {
     console.log('NenÃ­ k dispozici pÅ™edchozÃ­ tag pro porovnÃ¡nÃ­');
   }
   ```

2. **Ãšprava release skriptu v package.json**
   ```json
   "scripts": {
     "release:patch": "npm run build && npm version patch -m 'chore(release): ğŸ“¦ bump version to %s' && node scripts/generate-changelog.js && gh release create v$(node -p \"require('./package.json').version\") -F CHANGELOG.md && npm publish && git push && git push --tags",
     "release:minor": "npm run build && npm version minor -m 'chore(release): ğŸ“¦ bump version to %s' && node scripts/generate-changelog.js && gh release create v$(node -p \"require('./package.json').version\") -F CHANGELOG.md && npm publish && git push && git push --tags",
     "release:major": "npm run build && npm version major -m 'chore(release): ğŸ“¦ bump version to %s' && node scripts/generate-changelog.js && gh release create v$(node -p \"require('./package.json').version\") -F CHANGELOG.md && npm publish && git push && git push --tags"
   }
   ```

### SlouÄenÃ­ commit zmÄ›n a release do jednoho kroku

Pro slouÄenÃ­ commit zmÄ›n a verze do jednoho kroku mÅ¯Å¾eme upravit release proces:

1. **PÅ™Ã­prava commit message s verzÃ­ pÅ™ed releasem**
```bash
# 1. PÅ™epnout na main a aktualizovat
git checkout main
git pull origin main

# 2. Merge development do main (uÅ¾ squashnutÃ½)
git merge development --no-commit  # SpojenÃ­ bez commitu

# 3. ZÃ­skÃ¡nÃ­ novÃ© verze
NEW_VERSION=$(npm version patch --no-git-tag-version)

# 4. VytvoÅ™enÃ­ commitu s verzÃ­
git add package.json
git commit -m "feat: ğŸš€ Release $NEW_VERSION

âœ¨ NovÃ¡ funkcionalita 1
ğŸ› Oprava chyby 2"

# 5. VytvoÅ™enÃ­ tagu
git tag -a v$NEW_VERSION -m "Version $NEW_VERSION"

# 6. Publikace
npm publish

# 7. Push zmÄ›n a tagu
git push && git push --tags

# 8. Synchronizace development s main
git checkout development
git fetch origin
git reset --hard origin/main
git push -f origin development
```